<?xml version="1.0" encoding="UTF-8"?>
<build-type xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" uuid="2a314add-7407-4c84-9030-508b8412a589" xsi:noNamespaceSchemaLocation="https://www.jetbrains.com/teamcity/schemas/2021.1/project-config.xsd">
  <name>Platform .NET (NuGet)*</name>
  <description>Disabled dependency</description>
  <settings>
    <inherits>
      <ref id="DevAi2x_PreBuild" />
      <ref id="DevAi2x_RunTestSuitesNet" />
      <ref id="DevAi2x_PostBuild" />
    </inherits>
    <options>
      <option name="artifactRules" value="work/log =&gt; logs.zip&#xA;**/hs_err*.log =&gt; crashdumps.zip&#xA;**/core =&gt; crashdumps.zip&#xA;./**/target/rat.txt =&gt; rat.zip&#xA;/home/teamcity/ignite-startNodes/*.log =&gt; ignite-startNodes.zip&#xA;./dev-tools/IGNITE-*-*.patch =&gt; patch&#xA;modules/platforms/dotnet/nupkg =&gt; nupkg" />
      <option name="executionTimeoutMin" value="120" />
    </options>
    <disabled-settings>
      <setting-ref ref="RUNNER_32" />
      <setting-ref ref="RUNNER_33" />
      <setting-ref ref="RUNNER_43" />
      <setting-ref ref="RUNNER_54" />
      <setting-ref ref="RUNNER_71" />
      <setting-ref ref="RUNNER_96" />
    </disabled-settings>
    <parameters>
      <param name="TARGET_RELEASE" value="Release" />
      <param name="env.JAVA_HOME" value="%env.JDK_ORA_18%" spec="text validationMode='any' display='hidden'" />
      <param name="env.PATH" value="%env.PATH%;%teamcity.tool.maven.DEFAULT%\bin" />
    </parameters>
    <build-runners order="RUNNER_264, RUNNER_287, RUNNER_32, RUNNER_33, RUNNER_43, RUNNER_54, RUNNER_71, RUNNER_96, RUNNER_122, RUNNER_177, RUNNER_163, RUNNER_164, RUNNER_165, RUNNER_10, RUNNER_266">
      <runner id="RUNNER_96" name="Build Java" type="Maven2">
        <parameters>
          <param name="goals" value="package" />
          <param name="localRepoScope" value="mavenDefault" />
          <param name="maven.path" value="%teamcity.tool.maven.DEFAULT%" />
          <param name="runnerArgs"><![CDATA[-U
-P-lgpl,-scala,-examples,-test,-benchmarks
-Dmaven.javadoc.skip=true
-DskipTests]]></param>
          <param name="target.jdk.home" value="%env.JDK_ORA_8%" />
          <param name="teamcity.coverage.emma.include.source" value="true" />
          <param name="teamcity.coverage.emma.instr.parameters" value="-ix -*Test*" />
          <param name="teamcity.coverage.idea.includePatterns" value="*" />
          <param name="teamcity.coverage.jacoco.patterns" value="+:*" />
          <param name="teamcity.step.mode" value="default" />
          <param name="userSettingsSelection" value="local-proxy.xml" />
        </parameters>
      </runner>
      <runner id="RUNNER_122" name="Build .NET" type="jetbrains_powershell">
        <parameters>
          <param name="jetbrains_powershell_bitness" value="x64" />
          <param name="jetbrains_powershell_edition" value="Desktop" />
          <param name="jetbrains_powershell_execution" value="PS1" />
          <param name="jetbrains_powershell_noprofile" value="true" />
          <param name="jetbrains_powershell_scriptArguments" value="-skipJava -skipDotNetCore" />
          <param name="jetbrains_powershell_script_file" value="modules/platforms/dotnet/build.ps1" />
          <param name="jetbrains_powershell_script_mode" value="FILE" />
          <param name="teamcity.build.workingDir" value="modules/platforms/dotnet" />
          <param name="teamcity.step.mode" value="default" />
        </parameters>
      </runner>
      <runner id="RUNNER_177" name="NuGet pack, install, restore" type="jetbrains_powershell">
        <parameters>
          <param name="jetbrains_powershell_bitness" value="x64" />
          <param name="jetbrains_powershell_edition" value="Desktop" />
          <param name="jetbrains_powershell_execution" value="PS1" />
          <param name="jetbrains_powershell_script_code"><![CDATA[$ng = (Get-Item .).FullName + '\nuget.exe'

if (!(Test-Path $ng)) {
    $ng = 'nuget'
}

$cfg = 'Release'
$ver = (gi ..\Apache.Ignite.Core\bin\$cfg\Apache.Ignite.Core.dll).VersionInfo.ProductVersion

rmdir nupkg -Force -Recurse
rmdir pkg -Force -Recurse

mkdir nupkg
mkdir pkg

# Find all nuspec files and run 'nuget pack' either directly, or on corresponding csproj files (if present).
ls ..\*.nuspec -Recurse  `
    | % { If (Test-Path ([io.path]::ChangeExtension($_.FullName, ".csproj"))){[io.path]::ChangeExtension($_.FullName, ".csproj")} Else {$_.FullName}  } `
    | % { & $ng pack $_ -Prop Configuration=$cfg -Version $ver -Prop Platform=AnyCPU -OutputDirectory nupkg }

# Replace versions in project files
(Get-Content packages.config) `
    -replace 'id="Apache.Ignite(.*?)" version=".*?"', ('id="Apache.Ignite$1" version="' + $ver + '"') `
    | Out-File packages.config -Encoding utf8

(Get-Content Apache.Ignite.Core.Tests.NuGet.csproj) `
    -replace 'packages\\Apache.Ignite(.*?)\.\d.*?\\', ('packages\Apache.Ignite$1.' + "$ver\") `
    | Out-File Apache.Ignite.Core.Tests.NuGet.csproj  -Encoding utf8

# restore packages
& $ng restore

# refresh content files
ls packages\*\content | % {copy ($_.FullName + "\*.*") .\ }]]></param>
          <param name="jetbrains_powershell_script_file" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet\install-package.ps1" />
          <param name="jetbrains_powershell_script_mode" value="FILE" />
          <param name="teamcity.build.workingDir" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet" />
          <param name="teamcity.step.mode" value="default" />
        </parameters>
      </runner>
      <runner id="RUNNER_163" name="Build .NET NuGet tests" type="MSBuild">
        <parameters>
          <param name="build-file-path" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet\Apache.Ignite.Core.Tests.NuGet.sln" />
          <param name="dotNetCoverage.NCover.HTMLReport.File.Sort" value="0" />
          <param name="dotNetCoverage.NCover.HTMLReport.File.Type" value="1" />
          <param name="dotNetCoverage.NCover.Reg" value="selected" />
          <param name="dotNetCoverage.NCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.Reg" value="selected" />
          <param name="dotNetCoverage.NCover3.args" value="//ias .*" />
          <param name="dotNetCoverage.NCover3.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover3.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.reporter.executable.args" value="//or FullCoverageReport:Html:{teamcity.report.path}" />
          <param name="dotNetCoverage.PartCover.Reg" value="selected" />
          <param name="dotNetCoverage.PartCover.includes" value="[*]*" />
          <param name="dotNetCoverage.PartCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.PartCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.dotCover.home.path" value="%teamcity.tool.JetBrains.dotCover.CommandLineTools.DEFAULT%" />
          <param name="msbuild_version" value="4.0" />
          <param name="run-platform" value="x64" />
          <param name="runnerArgs"><![CDATA[/p:Configuration=Release
/p:Platform="Any CPU" /p:PlatformToolset=Windows7.1SDK /p:ShouldUnsetParentConfigurationAndPlatform=false
/val /m /nologo /ds]]></param>
          <param name="targets" value="Clean;Rebuild" />
          <param name="teamcity.build.workingDir" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet" />
          <param name="teamcity.step.mode" value="default" />
          <param name="toolsVersion" value="4.0" />
        </parameters>
      </runner>
      <runner id="RUNNER_164" name="Run NuGet tests (x86)" type="NUnit">
        <parameters>
          <param name="dotNetCoverage.NCover.HTMLReport.File.Sort" value="0" />
          <param name="dotNetCoverage.NCover.HTMLReport.File.Type" value="1" />
          <param name="dotNetCoverage.NCover.Reg" value="selected" />
          <param name="dotNetCoverage.NCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.Reg" value="selected" />
          <param name="dotNetCoverage.NCover3.args" value="//ias .*" />
          <param name="dotNetCoverage.NCover3.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover3.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.reporter.executable.args" value="//or FullCoverageReport:Html:{teamcity.report.path}" />
          <param name="dotNetCoverage.PartCover.Reg" value="selected" />
          <param name="dotNetCoverage.PartCover.includes" value="[*]*" />
          <param name="dotNetCoverage.PartCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.PartCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.dotCover.home.path" value="%teamcity.tool.JetBrains.dotCover.CommandLineTools.DEFAULT%" />
          <param name="dotNetTestRunner.Type" value="NUnit" />
          <param name="nunit_enabled" value="checked" />
          <param name="nunit_environment" value="v4.0" />
          <param name="nunit_include" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet\bin\Release\Apache.Ignite.Core.Tests.NuGet.exe" />
          <param name="nunit_platform" value="x86" />
          <param name="nunit_version" value="NUnit-2.6.3" />
          <param name="teamcity.step.mode" value="default" />
        </parameters>
      </runner>
      <runner id="RUNNER_165" name="Run NuGet tests (x64)" type="NUnit">
        <parameters>
          <param name="dotNetCoverage.NCover.HTMLReport.File.Sort" value="0" />
          <param name="dotNetCoverage.NCover.HTMLReport.File.Type" value="1" />
          <param name="dotNetCoverage.NCover.Reg" value="selected" />
          <param name="dotNetCoverage.NCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.Reg" value="selected" />
          <param name="dotNetCoverage.NCover3.args" value="//ias .*" />
          <param name="dotNetCoverage.NCover3.platformBitness" value="x86" />
          <param name="dotNetCoverage.NCover3.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.NCover3.reporter.executable.args" value="//or FullCoverageReport:Html:{teamcity.report.path}" />
          <param name="dotNetCoverage.PartCover.Reg" value="selected" />
          <param name="dotNetCoverage.PartCover.includes" value="[*]*" />
          <param name="dotNetCoverage.PartCover.platformBitness" value="x86" />
          <param name="dotNetCoverage.PartCover.platformVersion" value="v2.0" />
          <param name="dotNetCoverage.dotCover.home.path" value="%teamcity.tool.JetBrains.dotCover.CommandLineTools.DEFAULT%" />
          <param name="dotNetTestRunner.Type" value="NUnit" />
          <param name="nunit_enabled" value="checked" />
          <param name="nunit_environment" value="v4.0" />
          <param name="nunit_include" value="modules\platforms\dotnet\Apache.Ignite.Core.Tests.NuGet\bin\Release\Apache.Ignite.Core.Tests.NuGet.exe" />
          <param name="nunit_platform" value="x64" />
          <param name="nunit_version" value="NUnit-2.6.3" />
          <param name="teamcity.step.mode" value="default" />
        </parameters>
      </runner>
      <runner id="RUNNER_10" name="Run NuGet verification script" type="jetbrains_powershell">
        <parameters>
          <param name="jetbrains_powershell_execution" value="PS1" />
          <param name="jetbrains_powershell_noprofile" value="true" />
          <param name="jetbrains_powershell_script_code"><![CDATA[if (Test-Path release/verify-nuget.ps1) {
  ./release/verify-nuget.ps1
}]]></param>
          <param name="jetbrains_powershell_script_mode" value="CODE" />
          <param name="teamcity.build.workingDir" value="modules/platforms/dotnet" />
          <param name="teamcity.step.mode" value="default" />
        </parameters>
      </runner>
    </build-runners>
    <vcs-settings />
    <requirements />
    <build-triggers />
    <cleanup />
  </settings>
</build-type>

