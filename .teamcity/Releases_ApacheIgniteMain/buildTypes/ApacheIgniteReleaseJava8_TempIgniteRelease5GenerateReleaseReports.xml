<?xml version="1.0" encoding="UTF-8"?>
<build-type xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" uuid="84fadaab-a4cb-4c8b-9977-dabae49519ed" xsi:noNamespaceSchemaLocation="https://www.jetbrains.com/teamcity/schemas/2021.1/project-config.xsd">
  <name>~[Obsolete] [IGNITE_RELEASE #5] Generate Release Reports</name>
  <description />
  <settings>
    <options>
      <option name="artifactRules" value="modules/tools/target/*.html&#xA;modules/tools/target/*.json&#xA;modules/tools/target/*.css" />
      <option name="cleanBuild" value="true" />
    </options>
    <parameters>
      <param name="Release Description" value="" spec="text display='normal' validationMode='any'" />
      <param name="Release Version" value="" spec="text display='normal' validationMode='not_empty'" />
    </parameters>
    <build-runners>
      <runner id="RUNNER_97" name="Build Ignite Tools" type="Maven2">
        <parameters>
          <param name="goals" value="clean package" />
          <param name="localRepoScope" value="mavenDefault" />
          <param name="maven.path" value="%teamcity.tool.maven.DEFAULT%" />
          <param name="pomLocation" value="modules/tools/pom.xml" />
          <param name="teamcity.coverage.emma.include.source" value="true" />
          <param name="teamcity.coverage.emma.instr.parameters" value="-ix -*Test*" />
          <param name="teamcity.coverage.idea.includePatterns" value="*" />
          <param name="teamcity.coverage.jacoco.patterns" value="+:*" />
          <param name="teamcity.step.mode" value="default" />
          <param name="userSettingsSelection" value="userSettingsSelection:default" />
        </parameters>
      </runner>
      <runner id="RUNNER_110" name="Create Report Template File" type="simpleRunner">
        <parameters>
          <param name="script.content"><![CDATA[template=$(cat <<EOF
{
  "header": "Apache IGNITE %Release Version%",
  "description": "%Release Description%",
  "outfile": "apache-ignite-%Release Version%.html",
  "servers": [
    {
      "id": 1,
      "apiurl": "https://issues.apache.org/jira/rest/api/2/",
      "baseUrl": "https://issues.apache.org/jira/browse/",
      "username": "",
      "password": ""
    }
  ],
  "items": [
    {
      "header": "Features and Improvements",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (\"New Feature\") and (component != documentation or component is EMPTY) and ((labels != .net and labels != .NET and labels != cpp) or labels is EMPTY) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Task) and (component != documentation or component is EMPTY) and ((labels != .net and labels != .NET and labels != cpp) or labels is EMPTY) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Improvement) and (component != documentation or component is EMPTY) and ((labels != .net and labels != .NET and labels != cpp) or labels is EMPTY) and status in (Closed, Resolved)"
        }
      ]
    },
    {
      "header": "Fixed",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and affectedVersion != %Release Version%  and type in (Bug) and (component != documentation or component is EMPTY) and ((labels != .net and labels != .NET  and labels != cpp) or labels is EMPTY) and status in (Closed, Resolved)"
        }
      ]
    },
    {
      "header": ".NET: Features and Improvements",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (\"New Feature\") and (component != documentation or component is EMPTY) and (labels = .net or labels = .NET) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Task) and (component != documentation or component is EMPTY) and (labels = .net or labels = .NET) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Improvement) and (component != documentation or component is EMPTY) and (labels = .net or labels = .NET) and status in (Closed, Resolved)"
        }
      ]
    },
    {
      "header": ".NET: Fixed",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and affectedVersion != %Release Version%  and type in (Bug) and (component != documentation or component is EMPTY) and (labels = .net or labels = .NET) and status in (Closed, Resolved)"
        }
      ]
    },
    {
      "header": "C++: Features and Improvements",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (\"New Feature\") and (component != documentation or component is EMPTY) and (labels = cpp) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Task) and (component != documentation or component is EMPTY) and (labels = cpp) and status in (Closed, Resolved)"
        },
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and type in (Improvement) and (component != documentation or component is EMPTY) and (labels = cpp) and status in (Closed, Resolved)"
        }
      ]
    },
    {
      "header": "C++: Fixed",
      "search": [
        { "server": 1,
          "showlink": true,
          "jql": "project in (\"IGNITE\") and fixVersion = %Release Version% and affectedVersion != %Release Version%  and type in (Bug) and (component != documentation or component is EMPTY) and (labels = cpp) and status in (Closed, Resolved)"
        }
      ]
    }
  ]
}
EOF
)

echo $template > modules/tools/target/report_template.json]]></param>
          <param name="teamcity.step.mode" value="default" />
          <param name="use.custom.script" value="true" />
        </parameters>
      </runner>
      <runner id="RUNNER_112" name="Create Report CSS File" type="simpleRunner">
        <parameters>
          <param name="script.content"><![CDATA[css=$(cat <<EOF
h1 {
  color: #113847;
  font-size: 33px;
  font-weight: bold;
  margin: 30px 0 15px 0;
  padding-bottom: 7px;
  width: 700px;
}h2 {  border-bottom: 2px solid #ccc;
  color: #113847;
  font-size: 29px;
  font-weight: normal;
  margin: 30px 0 15px 0;
  padding-bottom: 7px;  width: 700px;
}a {
  color: #cc0000;
  text-decoration: none;
}
span {
  color: #cc0000;
}
a:hover {
  text-decoration: underline;
}
ul,
ol {
  list-style: disc;
  margin-left: 30px;
}

ul li,
ol li {
  margin: 5px 0;
}

p.description {
  width: 700px;
}

EOF
)

echo $css > modules/tools/target/report_template.css]]></param>
          <param name="teamcity.step.mode" value="default" />
          <param name="use.custom.script" value="true" />
        </parameters>
      </runner>
      <runner id="RUNNER_104" name="Build HTML Release Report" type="simpleRunner">
        <parameters>
          <param name="script.content"><![CDATA[cd modules/tools/target
ls -la
java -cp "./*:libs/*" org.apache.ignite.tools.release.ReleaseReportGenerator]]></param>
          <param name="teamcity.step.mode" value="default" />
          <param name="use.custom.script" value="true" />
        </parameters>
      </runner>
    </build-runners>
    <vcs-settings>
      <vcs-entry-ref root-id="GitHubApacheIgnite" />
    </vcs-settings>
    <requirements>
      <does-not-equal id="RQ_17" name="env.OS" value="Windows_NT" />
    </requirements>
    <build-triggers />
    <cleanup />
  </settings>
</build-type>

